---
const { open = false, id } = Astro.props;
---
<accordion-component class="accordion-container" data-open={String(open)}>
  <h3>
    <button
      id={`accordion-header-${id}`}
      class="accordion flex items-center justify-between w-full px-3 py-2.5 group hover:bg-gray-800/50 transition-colors rounded-t-lg"
      aria-expanded={open}
      aria-controls={`accordion-panel-${id}`}
    >
      <slot name="title" />
      <svg class="accordion-chevron w-4 h-4 flex-shrink-0 text-gray-500 group-hover:text-gray-400 transition-all" aria-hidden="true" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
      </svg>
    </button>
  </h3>
  <div
    id={`accordion-panel-${id}`}
    role="region"
    aria-labelledby={`accordion-header-${id}`}
    class="overflow-hidden px-3 pb-3 pt-1"
    hidden={!open}
  >
    <slot name="content" />
  </div>
</accordion-component>

<script>
  interface AccordionElement extends HTMLElement {
    button: HTMLButtonElement | null;
    panel: HTMLElement | null;
    open: boolean;
    toggle: () => void;
    updateState: () => void;
  }

  class Accordion extends HTMLElement implements AccordionElement {
    button: HTMLButtonElement | null = null;
    panel: HTMLElement | null = null;
    open: boolean = false;

    constructor() {
      super();
      this.toggle = this.toggle.bind(this);
    }

    connectedCallback(): void {
      this.button = this.querySelector('button');
      this.panel = this.querySelector('[role="region"]');

      if (!this.button || !this.panel) {
        if (import.meta.env.DEV) {
          console.error('Accordion: Required elements not found');
        }
        return;
      }

      this.open = this.dataset.open === 'true';
      this.updateState();
      this.button.addEventListener('click', this.toggle);
    }

    updateState(): void {
      if (!this.button || !this.panel) return;

      this.button.setAttribute('aria-expanded', String(this.open));
      this.panel.hidden = !this.open;
      this.button.classList.toggle('active', this.open);
    }

    toggle(): void {
      this.open = !this.open;
      this.updateState();
    }

    disconnectedCallback(): void {
      if (this.button) {
        this.button.removeEventListener('click', this.toggle);
      }
    }
  }

  if (!customElements.get('accordion-component')) {
    customElements.define('accordion-component', Accordion);
  }
</script>

<style>
	.accordion-container button[aria-expanded="false"] .accordion-chevron {
		transform: rotate(-90deg);
	}
	.accordion-container button[aria-expanded="true"] {
		background: rgba(255, 255, 255, 0.05);
	}
</style>