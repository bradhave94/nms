---
import Layout from '@layouts/Layout.astro';
import CompactCard from '@components/CompactCard.astro';
import Pagination from '@components/Pagination.astro';
import Breadcrumbs from '@components/Breadcrumbs.astro';
import { getSlug, sort } from '@utils/lookup.js';
import { buildCollectionStructuredData, getSiteOrigin } from '@utils/structuredData.js';
import { buildCategoryBreadcrumbs, buildCategoryIntro, buildPaginatedMeta } from '@utils/seo.js';
import type { Item } from '@utils/lookup.js';
import data from '@datav2/Products.json';

export async function getStaticPaths({ paginate }: { paginate: <T>(data: T[], options: { pageSize: number }) => unknown[] }) {
	return paginate(sort(data as Item[]), { pageSize: 80 });
}
// All paginated data is passed on the "page" prop
interface PageProps {
	page: {
		data: Item[];
		currentPage: number;
		lastPage: number;
		url: {
			prev?: string;
			next?: string;
		};
	};
}
const { page } = Astro.props as PageProps;
const siteOrigin = getSiteOrigin(Astro.site, Astro.url);
const canonicalUrl = new URL(Astro.url.pathname, siteOrigin).toString();
const itemListElements = page.data.map((item, index) => ({
	name: item.Name,
	url: `${siteOrigin}${getSlug(item)}`,
	position: (page.currentPage - 1) * 80 + index + 1,
}));
const structuredData = buildCollectionStructuredData({
	siteOrigin,
	canonicalUrl,
	collectionName: 'Products',
	collectionDescription: "A list of products for No Man's Sky. Our guide has everything you need to take your game to the next level.",
	collectionPath: '/products',
	currentPage: page.currentPage,
	items: itemListElements,
});
const breadcrumbs = buildCategoryBreadcrumbs('Products', '/products', page.currentPage);
const intro = buildCategoryIntro(
	'Products include crafted components, trade goods, and advanced materials used throughout your journey.',
	page.currentPage,
	page.lastPage
);
const baseDescription = "A list of products for No Man's Sky. Our guide has everything you need to take your game to the next level.";
const { title, description } = buildPaginatedMeta('Products', baseDescription, page.currentPage, page.lastPage);
---

<Layout
	{title}
	{description}
	slug="products"
	structuredData={structuredData}
>
	<Breadcrumbs items={breadcrumbs} className="pt-2 mb-6" />
	<h1 class="text-center text-4xl sm:text-6xl my-12">Products</h1>
	<p class="mx-auto mb-8 max-w-3xl text-center text-sky-200/90">{intro}</p>
	<div id="items" class="grid grid-cols-2 gap-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-6 xl:grid-cols-8">
		{
			page.data.map((item, index) => (
				<CompactCard
					card={{
						name: item.Name,
						image: 'https://nomansskyrecipes.com/images/items/' + item.Icon,
						link: getSlug(item),
					}}
					index={index}
				/>
			))
		}
	</div>
	<Pagination page={page} />
</Layout>
